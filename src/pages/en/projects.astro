---
import { getCollection } from 'astro:content';
import BaseLayout from '@layouts/BaseLayout.astro';
import ProjectsHero from '@components/projects/ProjectsHero.astro';
import ProjectsIntro from '@components/projects/ProjectsIntro.astro';
import ProjectsFilter from '@components/projects/ProjectsFilter.astro';
import ProjectsGrid from '@components/projects/ProjectsGrid.astro';

const lang = 'en';
const title = 'Our Projects - AutomX Portfolio';
const description = 'Discover our achievements in web development, mobile applications, automation and data analysis. Innovative solutions for ambitious clients.';

// Get all published projects
const allProjects = await getCollection('projects-en', ({ data }) => data.published === true);

// Calculate counts by category
const counts = {
  all: allProjects.length,
  'web-development': allProjects.filter(p => p.data.category === 'web-development').length,
  'process-automation': allProjects.filter(p => p.data.category === 'process-automation').length,
  'data-analysis': allProjects.filter(p => p.data.category === 'data-analysis').length,
};
---

<BaseLayout
  lang={lang}
  title={title}
  description={description}
  noindex={false}
>
  <!-- Disable scroll snap for projects page only -->
  <style is:global>
    html {
      scroll-snap-type: none !important;
    }

    section {
      scroll-snap-align: none !important;
    }
  </style>

  <!-- Projects Hero Section -->
  <ProjectsHero />

  <!-- Projects Introduction & Features -->
  <ProjectsIntro />

  <!-- Filter Section -->
  <ProjectsFilter counts={counts} />

  <!-- Projects Grid -->
  <ProjectsGrid />

  <!-- Initialize scroll animations -->
  <script>
    import '@scripts/scroll-animations.ts';
  </script>
</BaseLayout>
