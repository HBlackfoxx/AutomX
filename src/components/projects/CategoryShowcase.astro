---
import { getCollection } from 'astro:content';

const lang = Astro.currentLocale || 'fr';

// Get all projects for current language
const collectionName = lang === 'fr' ? 'projects-fr' : 'projects-en';
const allProjects = await getCollection(collectionName, ({ data }) => data.published === true);

// Group projects by category
const webDevProjects = allProjects.filter(p => p.data.category === 'web-development');
const dataProjects = allProjects.filter(p => p.data.category === 'data-analysis');
const automationProjects = allProjects.filter(p => p.data.category === 'process-automation');

// Category configuration
const categories = {
  'web-development': {
    title: lang === 'en' ? 'Web Development' : 'Développement Web',
    icon: 'code',
    color: 'cyan',
    description: lang === 'en' ? 'Modern, high-performance web applications' : 'Applications web modernes et performantes',
    projects: webDevProjects
  },
  'data-analysis': {
    title: lang === 'en' ? 'Data Analysis' : 'Analyse de Données',
    icon: 'chart',
    color: 'purple',
    description: lang === 'en' ? 'Insights and predictive analytics' : 'Insights et analyses prédictives',
    projects: dataProjects
  },
  'process-automation': {
    title: lang === 'en' ? 'Automation' : 'Automatisation',
    icon: 'bolt',
    color: 'green',
    description: lang === 'en' ? 'Automated workflows saving time' : 'Workflows automatisés économisant du temps',
    projects: automationProjects
  }
};

const iconPaths = {
  code: 'M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4',
  chart: 'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z',
  bolt: 'M13 10V3L4 14h7v7l9-11h-7z'
};
---

<section class="relative py-16 md:py-24 bg-background overflow-hidden">
  <div class="cyber-grid-light"></div>

  <div class="container-custom relative z-10">
    <!-- Categories Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      {Object.entries(categories).map(([key, category]) => (
        <div class="category-section">
          <!-- Category Header -->
          <div class="mb-8 fade-in-scroll">
            <div class={`inline-flex items-center gap-2 px-3 py-1 rounded-full border border-${category.color}-500/30 bg-${category.color}-500/10 mb-4`}>
              <svg class={`w-4 h-4 text-${category.color}-500`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={iconPaths[category.icon as keyof typeof iconPaths]} />
              </svg>
              <span class={`text-xs font-mono text-${category.color}-500 uppercase tracking-widest`}>{category.title}</span>
            </div>
            <h2 class="text-2xl md:text-3xl font-bold mb-2">{category.title}</h2>
            <p class="text-sm text-muted-foreground font-mono">{category.description}</p>
            <div class="mt-4 h-1 w-20 bg-gradient-to-r from-${category.color}-500 to-transparent rounded-full"></div>
          </div>

          <!-- Projects in Category -->
          <div class="space-y-6">
            {category.projects.length === 0 ? (
              <div class="text-center py-12 border border-border/30 rounded-lg bg-background/50">
                <p class="text-muted-foreground font-mono text-sm">
                  {lang === 'en' ? 'No projects yet' : 'Aucun projet pour le moment'}
                </p>
              </div>
            ) : (
              category.projects.map((project: any) => (
                <a
                  href={lang === 'fr' ? `/projet/${project.slug}` : `/en/project/${project.slug}`}
                  class="card-border-glow-hover card-hover-glow block relative p-[1px] overflow-hidden rounded-lg fade-in-scroll group"
                >
                  <div class="absolute inset-0 rounded-lg bg-gradient-to-b from-grey-30/60 via-grey-25/30 to-transparent"></div>
                  <div class="relative rounded-lg bg-background p-6">
                    {/* Featured Badge */}
                    {project.data.featured && (
                      <div class="absolute top-4 right-4 px-2 py-1 rounded-full bg-cyan-500/20 border border-cyan-500/30">
                        <span class="text-[10px] font-mono text-cyan-500 uppercase tracking-wider">
                          {lang === 'en' ? 'Featured' : 'Vedette'}
                        </span>
                      </div>
                    )}

                    {/* Project Info */}
                    <div class="mb-4">
                      <h3 class={`font-bold text-lg mb-2 group-hover:text-${category.color}-500 transition-colors`}>
                        {project.data.title}
                      </h3>
                      <p class="text-sm text-muted-foreground line-clamp-2 mb-3">
                        {project.data.description}
                      </p>
                    </div>

                    {/* Meta Info */}
                    <div class="flex flex-wrap gap-2 mb-4">
                      <span class="px-2 py-1 text-[10px] font-mono bg-background border border-border/30 rounded">
                        {project.data.client}
                      </span>
                      <span class="px-2 py-1 text-[10px] font-mono bg-background border border-border/30 rounded">
                        {project.data.date}
                      </span>
                    </div>

                    {/* Tech Stack */}
                    <div class="flex flex-wrap gap-1.5 mb-4">
                      {project.data.technologies.slice(0, 3).map((tech: string) => (
                        <span class={`px-2 py-0.5 text-[10px] font-mono bg-${category.color}-500/10 border border-${category.color}-500/30 rounded text-${category.color}-500`}>
                          {tech}
                        </span>
                      ))}
                      {project.data.technologies.length > 3 && (
                        <span class="px-2 py-0.5 text-[10px] font-mono text-muted-foreground">
                          +{project.data.technologies.length - 3}
                        </span>
                      )}
                    </div>

                    {/* CTA */}
                    <div class="flex items-center gap-2 text-sm font-mono group-hover:text-cyan-500 transition-colors">
                      <span>{lang === 'en' ? 'View project' : 'Voir le projet'}</span>
                      <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                      </svg>
                    </div>
                  </div>
                </a>
              ))
            )}
          </div>

          {/* View All Button */}
          {category.projects.length > 0 && (
            <div class="mt-6">
              <button
                class={`w-full py-3 px-4 rounded-lg border-2 border-${category.color}-500/30 hover:border-${category.color}-500 bg-${category.color}-500/5 hover:bg-${category.color}-500/10 transition-all duration-300 group`}
              >
                <span class={`text-sm font-mono font-bold text-${category.color}-500 uppercase tracking-wider flex items-center justify-center gap-2`}>
                  {lang === 'en' ? `View all ${category.title}` : `Voir tous les ${category.title}`}
                  <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                  </svg>
                </span>
              </button>
            </div>
          )}
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  .category-section {
    animation: fadeInUp 0.6s ease-out forwards;
    opacity: 0;
  }

  .category-section:nth-child(1) {
    animation-delay: 0.1s;
  }

  .category-section:nth-child(2) {
    animation-delay: 0.2s;
  }

  .category-section:nth-child(3) {
    animation-delay: 0.3s;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Dynamic color classes */
  .border-cyan-500\/30 { border-color: rgb(6 182 212 / 0.3); }
  .bg-cyan-500\/10 { background-color: rgb(6 182 212 / 0.1); }
  .text-cyan-500 { color: rgb(6 182 212); }

  .from-cyan-500 { --tw-gradient-from: rgb(6 182 212); }
</style>
