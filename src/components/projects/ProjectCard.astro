---
interface Props {
  title: string;
  description: string;
  client: string;
  category: 'web-development' | 'process-automation' | 'data-analysis';
  date: string;
  technologies: string[];
  featured?: boolean;
  featuredImage?: string;
  slug: string;
  lang: 'fr' | 'en';
  results?: Array<{ metric: string; value: string; description?: string }>;
}

const {
  title,
  description,
  client,
  category,
  date,
  technologies,
  featured = false,
  featuredImage,
  slug,
  lang,
  results
} = Astro.props;

// Category configuration
const categoryConfig = {
  'web-development': {
    label: lang === 'en' ? 'Web Dev' : 'Dév Web',
    color: 'cyan',
    gradient: 'from-cyan-500/20 to-cyan-500/5',
    border: 'border-cyan-500/30',
    text: 'text-cyan-500',
    bg: 'bg-cyan-500/10',
    icon: 'M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4'
  },
  'process-automation': {
    label: lang === 'en' ? 'Automation' : 'Automatisation',
    color: 'green',
    gradient: 'from-cyan-500/20 to-cyan-500/5',
    border: 'border-cyan-500/30',
    text: 'text-cyan-500',
    bg: 'bg-cyan-500/10',
    icon: 'M13 10V3L4 14h7v7l9-11h-7z'
  },
  'data-analysis': {
    label: lang === 'en' ? 'Data Analysis' : 'Analyse Données',
    color: 'purple',
    gradient: 'from-cyan-500/20 to-cyan-500/5',
    border: 'border-cyan-500/30',
    text: 'text-cyan-500',
    bg: 'bg-cyan-500/10',
    icon: 'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z'
  }
};

const config = categoryConfig[category];
const projectUrl = lang === 'fr' ? `/projet/${slug}` : `/en/project/${slug}`;

// Format date
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString(lang === 'fr' ? 'fr-FR' : 'en-US', {
    year: 'numeric',
    month: 'short'
  });
};
---

<a
  href={projectUrl}
  class="project-card group block"
  data-category={category}
  data-featured={featured}
  data-client={client.toLowerCase()}
  data-technologies={technologies.join(',').toLowerCase()}
>
  <!-- Card Border & Glow -->
  <div class="card-border absolute inset-0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

  <!-- Card Content -->
  <div class="card-content relative bg-grey-10 rounded-xl overflow-hidden h-full">

    <!-- Featured Image (if available) -->
    {featuredImage && (
      <div class="card-image relative h-48 overflow-hidden bg-grey-15">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-grey-10"></div>

        <!-- Category Badge on Image -->
        <div class="absolute top-4 left-4 z-10">
          <div class={`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg ${config.bg} ${config.border} border backdrop-blur-sm`}>
            <svg class={`w-4 h-4 ${config.text}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={config.icon} />
            </svg>
            <span class={`text-xs font-mono font-semibold ${config.text} uppercase tracking-wider`}>
              {config.label}
            </span>
          </div>
        </div>

        {featured && (
          <div class="absolute top-4 right-4 z-10">
            <div class="px-3 py-1.5 rounded-lg bg-cyan-500/20 border border-cyan-500/40 backdrop-blur-sm">
              <span class="text-xs font-mono font-semibold text-cyan-400 uppercase tracking-wider flex items-center gap-1.5">
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                {lang === 'en' ? 'Featured' : 'Vedette'}
              </span>
            </div>
          </div>
        )}
      </div>
    )}

    <!-- Card Body -->
    <div class="card-body p-6">

      <!-- Category Badge (if no image) -->
      {!featuredImage && (
        <div class="flex items-center justify-between mb-4">
          <div class={`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg ${config.bg} ${config.border} border`}>
            <svg class={`w-4 h-4 ${config.text}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={config.icon} />
            </svg>
            <span class={`text-xs font-mono font-semibold ${config.text} uppercase tracking-wider`}>
              {config.label}
            </span>
          </div>

          {featured && (
            <div class="px-2.5 py-1 rounded-md bg-cyan-500/20 border border-cyan-500/40">
              <span class="text-[10px] font-mono font-semibold text-cyan-400 uppercase tracking-wider flex items-center gap-1">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                {lang === 'en' ? 'Featured' : 'Vedette'}
              </span>
            </div>
          )}
        </div>
      )}

      <!-- Title & Description -->
      <div class="mb-4">
        <h3 class="card-title text-xl font-bold mb-2 text-white group-hover:text-cyan-400 transition-colors duration-300">
          {title}
        </h3>
        <p class="text-sm text-white-60 leading-relaxed line-clamp-2">
          {description}
        </p>
      </div>

      <!-- Client & Date -->
      <div class="flex items-center gap-3 mb-4 text-xs font-mono">
        <div class="flex items-center gap-1.5 text-white-55">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
          <span>{client}</span>
        </div>
        <span class="text-grey-40">•</span>
        <div class="flex items-center gap-1.5 text-white-55">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <span>{formatDate(date)}</span>
        </div>
      </div>

      <!-- Technologies -->
      <div class="flex flex-wrap gap-2 mb-4">
        {technologies.slice(0, 4).map((tech) => (
          <span class="tech-tag px-2.5 py-1 text-[11px] font-mono bg-grey-20 border border-grey-30 rounded-md text-white-65 hover:border-cyan-500/50 hover:text-cyan-400 transition-all duration-200">
            {tech}
          </span>
        ))}
        {technologies.length > 4 && (
          <span class="px-2.5 py-1 text-[11px] font-mono text-white-50 bg-grey-20/50 border border-grey-30/50 rounded-md">
            +{technologies.length - 4}
          </span>
        )}
      </div>

      <!-- Results Metrics (if available) -->
      {results && results.length > 0 && (
        <div class="grid grid-cols-2 gap-2 mb-4 pt-4 border-t border-grey-25">
          {results.slice(0, 2).map((result) => (
            <div class="text-center py-2 px-3 rounded-lg bg-grey-15 border border-grey-25">
              <div class={`text-lg font-bold font-mono ${config.text} mb-0.5`}>
                {result.value}
              </div>
              <div class="text-[10px] font-mono text-white-50 uppercase tracking-wider">
                {result.metric}
              </div>
            </div>
          ))}
        </div>
      )}

      <!-- CTA Button -->
      <div class="flex items-center justify-between pt-4 border-t border-grey-25">
        <span class="text-sm font-mono text-white-60 group-hover:text-cyan-400 transition-colors duration-300">
          {lang === 'en' ? 'View project' : 'Voir le projet'}
        </span>
        <div class="cta-arrow flex items-center justify-center w-8 h-8 rounded-full bg-grey-20 border border-grey-30 group-hover:bg-cyan-500 group-hover:border-cyan-500 transition-all duration-300">
          <svg class="w-4 h-4 text-white-60 group-hover:text-black transition-all duration-300 group-hover:translate-x-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </div>
      </div>
    </div>
  </div>
</a>

<style>
  .project-card {
    position: relative;
    height: 100%;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .project-card:hover {
    transform: translateY(-8px);
  }

  /* Card Border Glow */
  .card-border {
    background: linear-gradient(
      135deg,
      rgba(6, 182, 212, 0.5) 0%,
      rgba(139, 92, 246, 0.3) 50%,
      rgba(6, 182, 212, 0.5) 100%
    );
    background-size: 200% 200%;
    animation: borderGlow 3s ease infinite;
    filter: blur(8px);
  }

  /* Card Content */
  .card-content {
    border: 1px solid rgba(76, 76, 76, 0.3);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
  }

  .project-card:hover .card-content {
    border-color: rgba(6, 182, 212, 0.5);
    box-shadow: 0 20px 60px rgba(6, 182, 212, 0.2);
  }

  /* Card Body fills remaining space */
  .card-body {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  /* Title hover effect */
  .card-title {
    position: relative;
    overflow: hidden;
  }

  /* Tech tag hover */
  .tech-tag {
    transition: all 0.2s ease;
  }

  /* Image overlay on hover */
  .card-image::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1;
  }

  .project-card:hover .card-image::before {
    opacity: 1;
  }

  /* Stagger animation for cards */
  .project-card {
    opacity: 0;
    animation: cardFadeIn 0.6s ease-out forwards;
  }

  @keyframes cardFadeIn {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Category-specific colors */
  .project-card[data-category="web-development"] .card-border {
    background: linear-gradient(135deg, rgba(6, 182, 212, 0.5) 0%, rgba(6, 182, 212, 0.2) 100%);
  }

  .project-card[data-category="process-automation"] .card-border {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.5) 0%, rgba(34, 197, 94, 0.2) 100%);
  }

  .project-card[data-category="data-analysis"] .card-border {
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.5) 0%, rgba(168, 85, 247, 0.2) 100%);
  }

  @keyframes borderGlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
</style>
