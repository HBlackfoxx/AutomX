---
import { useTranslations } from '@i18n/utils';
import faqData from '@data/faq.json';

const lang = Astro.currentLocale || 'fr';
const { t } = useTranslations(lang as 'fr' | 'en');
---

<section class="relative py-20 md:py-32 bg-background overflow-hidden" id="faq">
  <div class="container-custom relative z-10">
    <!-- Section Header -->
    <div class="text-center max-w-4xl mx-auto mb-16 fade-in-scroll">
      <!-- Case Studies Badge -->
      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full border border-cyan-500/30 backdrop-blur-sm mb-4">
        <span class="pulse-dot"></span>
        <span class="text-xs font-mono text-cyan-500 uppercase tracking-widest">FAQ</span>
      </div>

      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4 text-foreground">
        {t('faq.title')}
      </h2>
      <p class="text-base md:text-lg text-muted-foreground leading-relaxed max-w-3xl mx-auto">
        {t('faq.subtitle')}
      </p>
    </div>

    <!-- FAQ Accordion - 2 Independent Columns -->
    <div class="max-w-7xl mx-auto flex flex-col lg:flex-row gap-x-12">
      <!-- Left Column -->
      <div class="flex-1">
        {faqData.filter((_, index) => index % 2 === 0).map((faq, index) => (
          <div
            class="faq-item fade-in-scroll border-b border-border py-6 transition-all duration-300"
            style={`animation-delay: ${index * 100}ms`}
            data-faq-id={faq.id}
          >
            <!-- Question Button -->
            <button
              class="faq-trigger w-full text-left flex items-center justify-between gap-4 group"
              aria-expanded="false"
              aria-controls={`faq-answer-${faq.id}`}
            >
              <span class="text-base font-semibold text-foreground group-hover:text-cyan-500 transition-colors pr-4">
                {t(faq.questionKey)}
              </span>
              <!-- Circular Plus/Minus Icon -->
              <div class="faq-icon-circle flex-shrink-0 w-8 h-8 rounded-full border border-border flex items-center justify-center transition-all duration-300 group-hover:border-cyan-500">
                <svg
                  class="faq-icon-plus w-4 h-4 text-foreground transition-all duration-300"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <svg
                  class="faq-icon-minus w-4 h-4 text-foreground transition-all duration-300 hidden"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </div>
            </button>

            <!-- Answer Content -->
            <div
              id={`faq-answer-${faq.id}`}
              class="faq-content"
              aria-hidden="true"
            >
              <div class="pt-4 pr-12">
                <p class="text-sm text-muted-foreground leading-relaxed">
                  {t(faq.answerKey)}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- Right Column -->
      <div class="flex-1">
        {faqData.filter((_, index) => index % 2 === 1).map((faq, index) => (
          <div
            class="faq-item fade-in-scroll border-b border-border py-6 transition-all duration-300"
            style={`animation-delay: ${(index * 100) + 50}ms`}
            data-faq-id={faq.id}
          >
            <!-- Question Button -->
            <button
              class="faq-trigger w-full text-left flex items-center justify-between gap-4 group"
              aria-expanded="false"
              aria-controls={`faq-answer-${faq.id}`}
            >
              <span class="text-base font-semibold text-foreground group-hover:text-cyan-500 transition-colors pr-4">
                {t(faq.questionKey)}
              </span>
              <!-- Circular Plus/Minus Icon -->
              <div class="faq-icon-circle flex-shrink-0 w-8 h-8 rounded-full border border-border flex items-center justify-center transition-all duration-300 group-hover:border-cyan-500">
                <svg
                  class="faq-icon-plus w-4 h-4 text-foreground transition-all duration-300"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <svg
                  class="faq-icon-minus w-4 h-4 text-foreground transition-all duration-300 hidden"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </div>
            </button>

            <!-- Answer Content -->
            <div
              id={`faq-answer-${faq.id}`}
              class="faq-content"
              aria-hidden="true"
            >
              <div class="pt-4 pr-12">
                <p class="text-sm text-muted-foreground leading-relaxed">
                  {t(faq.answerKey)}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  .faq-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
  }

  .faq-item.active .faq-content {
    max-height: 500px;
    transition: max-height 0.4s ease-in;
  }

  /* Toggle plus/minus icons */
  .faq-item.active .faq-icon-plus {
    display: none;
  }

  .faq-item.active .faq-icon-minus {
    display: block !important;
  }

  /* No special border/shadow for active items - keep it clean */
  .faq-item.active .faq-trigger span {
    color: #0ea5e9;
  }

  /* Circular icon on hover */
  .faq-icon-circle {
    background: transparent;
  }

  .faq-item:hover .faq-icon-circle {
    background: rgba(14, 165, 233, 0.05);
  }
</style>

<script>
  // FAQ Accordion functionality
  document.addEventListener('DOMContentLoaded', () => {
    const faqTriggers = document.querySelectorAll('.faq-trigger');

    // Accordion functionality - each item toggles independently
    faqTriggers.forEach(trigger => {
      trigger.addEventListener('click', () => {
        const faqItem = trigger.closest('.faq-item');
        const isActive = faqItem?.classList.contains('active');
        const content = faqItem?.querySelector('.faq-content');

        // Toggle current FAQ item (each item independent, no auto-close)
        if (faqItem && content) {
          if (isActive) {
            faqItem.classList.remove('active');
            trigger.setAttribute('aria-expanded', 'false');
            content.setAttribute('aria-hidden', 'true');
          } else {
            faqItem.classList.add('active');
            trigger.setAttribute('aria-expanded', 'true');
            content.setAttribute('aria-hidden', 'false');
          }
        }
      });
    });

    // NO default open item - all start closed
  });
</script>
